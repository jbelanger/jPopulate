<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>jPopulate - Advanced usage demo</title>
    <script src="Scripts/jquery-1.7.2.min.js" type="text/javascript"></script>
    <script src="Scripts/jpopulate.js" type="text/javascript"></script>
    <script src="Scripts/jquery.jmsajax.min.js" type="text/javascript"></script>

    <style type="text/css">
        .formFiller > div{clear:left; padding:5px;}
        td{ text-align:center;}
        table{background-color:LightGray;}
        .btnFormToJson{margin:10px 0px;}
        #resultedJson{background-color:LightGray; border:1px solid black; min-height:100px;}
    </style>
</head>
<body>
<h1>Advanced usage</h1>
<h2>A book library example</h2>
<h3>Borrowed books (feel free to change)</h3>
<textarea style="width:100%;" id="jsonStr" rows="12">
{ "Books" : [ 
    { "ISBN" : "Book1", "Client" : { "MemberId" : "00058", "Name" : "Joe Blo" }, "ReturnedDate" : "2012-05-31" } ,
    { "ISBN" : "Book2", "Client" : { "MemberId" : "00089", "Name" : "Mary Antoinette" }, "ReturnedDate" : "2012-08-09" },
    { "ISBN" : "Book3", "Client" : { "MemberId" : "00054", "Name" : "Steve Wonder" }, "ReturnedDate" : "2012-01-01" },
    { "ISBN" : "Book4", "Client" : { "MemberId" : "00001", "Name" : "John Smith" }, "ReturnedDate" : "2011-05-06" },
    { "ISBN" : "Book5", "Client" : { "MemberId" : "00100", "Name" : "Marc Larrivée" }, "ReturnedDate" : "2012-09-09" },
    { "ISBN" : "Book6", "Client" : { "MemberId" : "00099", "Name" : "Michel LeBricoleur" }, "ReturnedDate" : "2012-01-09" },
    { "ISBN" : "Book7", "Client" : { "MemberId" : "00011", "Name" : "Bob Gratton" }, "ReturnedDate" : "2012-03-03" },
    { "ISBN" : "Book8", "Client" : { "MemberId" : "00087", "Name" : "Martha Stewart" }, "ReturnedDate" : "2012-07-08" },
    { "ISBN" : "Book9", "Client" : { "MemberId" : "00033", "Name" : "Kate Thompson" }, "ReturnedDate" : "2012-02-02" },
    { "ISBN" : "Book10", "Client" : { "MemberId" : "00022", "Name" : "Calvin Klein" }, "ReturnedDate" : "2012-04-14" }
    ]
}
</textarea>
<br />
    <input type="button" id="btnBind" value ="Populate" />
    <input type="button" id="btnReset" value ="Reset" />

<h3>Library</h3>
<table border="1" data-field="Books/ISBN">
    <thead>
        <tr>
            <th style="width:10%;">Borrowed</th>
            <th style="width:40%;">Book Name</th>
            <th style="width:40%;">Client</th>
            <th style="width:10%;">Returned date</th>
        </tr>
    </thead>
    <tbody>
        <tr data-dataitemid="Book1">
            <td><input type="checkbox" value="Book1" data-bind="ISBN" /></td>
            <td>Harry Potter and the Philosopher's Stone</td>
            <td>
                <label>MemberId </label><input type="text" data-bind="Client.MemberId" />
                <label>Name </label><input type="text" data-bind="Client.Name" />
            </td>
            <td><input type="text" data-bind="ReturnedDate" /></td>
        </tr>
        <tr data-dataitemid="Book2">
            <td><input type="checkbox" value="Book2" data-bind="ISBN" /></td>
            <td>Harry Potter and the Chamber of Secrets</td>
            <td>
                <label>MemberId </label><input type="text" data-bind="Client.MemberId" />
                <label>Name </label><input type="text" data-bind="Client.Name" />
            </td>
            <td><input type="text" data-bind="ReturnedDate" /></td>
        </tr>
        <tr data-dataitemid="Book3">
            <td><input type="checkbox" value="Book3" data-bind="ISBN" /></td>
            <td>The Fellowship of the Ring</td>
            <td>
                <label>MemberId </label><input type="text" data-bind="Client.MemberId" />
                <label>Name </label><input type="text" data-bind="Client.Name" />
            </td>
            <td><input type="text" data-bind="ReturnedDate" /></td>
        </tr>        
        <tr data-dataitemid="Book4">
            <td><input type="checkbox" value="Book4" data-bind="ISBN" /></td>
            <td>The Two Towers</td>
            <td>
                <label>MemberId </label><input type="text" data-bind="Client.MemberId" />
                <label>Name </label><input type="text" data-bind="Client.Name" />
            </td>
            <td><input type="text" data-bind="ReturnedDate" /></td>
        </tr>        
        <tr data-dataitemid="Book5">
            <td><input type="checkbox" value="Book5" data-bind="ISBN" /></td>
            <td>Assassin's apprentice</td>
            <td>
                <label>MemberId </label><input type="text" data-bind="Client.MemberId" />
                <label>Name </label><input type="text" data-bind="Client.Name" />
            </td>
            <td><input type="text" data-bind="ReturnedDate" /></td>
        </tr>        
        <tr data-dataitemid="Book6">
            <td><input type="checkbox" value="Book6" data-bind="ISBN" /></td>
            <td>The Return of the king</td>
            <td>
                <label>MemberId </label><input type="text" data-bind="Client.MemberId" />
                <label>Name </label><input type="text" data-bind="Client.Name" />
            </td>
            <td><input type="text" data-bind="ReturnedDate" /></td>
        </tr>        
        <tr data-dataitemid="Book7">
            <td><input type="checkbox" value="Book7" data-bind="ISBN" /></td>
            <td>The Hobbit</td>
            <td>
                <label>MemberId </label><input type="text" data-bind="Client.MemberId" />
                <label>Name </label><input type="text" data-bind="Client.Name" />
            </td>
            <td><input type="text" data-bind="ReturnedDate" /></td>
        </tr>        
        <tr data-dataitemid="Book8">
            <td><input type="checkbox" value="Book8" data-bind="ISBN" /></td>
            <td>Royal Assassin</td>
            <td>
                <label>MemberId </label><input type="text" data-bind="Client.MemberId" />
                <label>Name </label><input type="text" data-bind="Client.Name" />
            </td>
            <td><input type="text" data-bind="ReturnedDate" /></td>
        </tr>        
        <tr data-dataitemid="Book9">
            <td><input type="checkbox" value="Book9" data-bind="ISBN" /></td>
            <td>Homeland</td>
            <td>
                <label>MemberId </label><input type="text" data-bind="Client.MemberId" />
                <label>Name </label><input type="text" data-bind="Client.Name" />
            </td>
            <td><input type="text" data-bind="ReturnedDate" /></td>
        </tr>
    </tbody>
</table>

<input class="btnFormToJson" type="button" value="Build object" />
<div id="resultedJson"></div>

<script type="text/javascript">

function removeNL(s){ 
  return s.replace(/[\n\r\t]/g,''); 
}

    $("#btnBind").click(function () {

        $("table").jpopulate("update", removeNL($("#jsonStr").val()));
    });

    $("#btnReset").click(function () {
        $("table").jpopulate("reset");
    });

    $(".btnFormToJson").click(function () {
        var obj = $("table").jpopulate("buildObject");
        $("#resultedJson").html(msJSON.stringify(obj));
    });

</script>

</body>
</html>
